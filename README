#-----------------------------------------------------------------------------
#	Copyright 2019 Baho Utot
#-----------------------------------------------------------------------------
#	This program is free software: you can redistribute it and/or modify
#	it under the terms of the GNU General Public License as published by
#	the Free Software Foundation, either version 3 of the License, or
#	(at your option) any later version.

#	This program is distributed in the hope that it will be useful,
#	but WITHOUT ANY WARRANTY; without even the implied warranty of
#	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#	GNU General Public License for more details.

#	You should have received a copy of the GNU General Public License
#	along with this program.  If not, see <https://www.gnu.org/licenses/>.
#-----------------------------------------------------------------------------
OVERVIEW:
	This creates a build environment 
	
#-----------------------------------------------------------------------------	
LAYOUT:
	/usr/src/Overlay
		+ 	bash_profile	-	root user in chroot
		+	bashrc		-	root user in chroot
		+	CHROOT		-	mount point for overlay chroots here
		+	HOST		-	host system clone   lower dir overlayfs
		+	LFS		-	Put your stuff to work on here 
						upper dir overlayfs
		+	macros		-	custom macro file for rpm
		+	Makefile		-	The big deal
		+	WORK		-	work dir for overlayfs
		+	README		-	This file
#-----------------------------------------------------------------------------
REQUIREMENTS:
	1.	overlayfs enabled kernel
	2.	sudo and configuerd for your user
#-----------------------------------------------------------------------------
PROCEDURE:
	git clone https://github.com/baho-utot/Overlay.git
	
	rsync -var /home/pi/Projects/Overlay .
	cd Overlay
	
### FIXME:
	make setup - remove cp to HOST
	make host - create a HOST.img file if you don't have one
	sudo make chroot
	source /root/.bash_profile
	/bin/bash --login That gives you a clean root user environment to work with.

### Building LFS:
	base build:
	rename HOST HOST.original
	rename LFS LFS.original
	mkdir HOST
	mkdir LFS
	rsync -var LFS/mnt/lfs/* HOST/
	mkdir LFS
	cp Bash_profile LFS/root/.bash_profile
	cp Bashrc LFS/root/.bashrc
	make chroot
	/tools/bin/bash --login
	Go build

	#	make Toolchain.img
	dd if=/dev/zero of=Toolchain.img bs=1M count=5120
	mkfs.ext4 Toolchain.img
	mount -t ext4 Toolchain.img CHROOT
	cp -var LFS/mnt/lfs/* CHROOT/
	mv CHROOT/usr/src/LFS/SOURCES CHROOT/
	rm CHROOT/usr/src/LFS
	rm -rf CHROOT/root
	mkdir CHROOT/root
	cp bash_profile CHROOT/root/.bash_profile
	cp bashrc CHROOT/root/.bashrc
	umount CHROOT
	
	Mount Toolchain.img at HOST
	clean LFS
	make chroot
	/tools/bin/bash --login
	/bin/bash --login
	git clone LFS to CHROOT/usr/src/LFS
	copy SOURCES/ to CHROOT/usr/src/LFS/SOURCES/
	Go build
